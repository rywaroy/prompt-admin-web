import{g as ge,b as xe}from"./index-e86b1908.js";import{c as s,A as ne,s as A,r as le,F as he,a as d,o as g,b as T,w as p,m as X,u as x,d as w,e as q,f as K,g as oe,t as Oe,h as C,i as P,_ as ye,j as we,k as b,l as Ce,n as Pe,p as Se,q as L,P as Y,E as ke,D as Le,C as $e,v as je,M as Z,x as V,y as Me,z as Ve}from"./index-c1bc0cdf.js";var Ae={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M872 474H152c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h720c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8z"}}]},name:"minus",theme:"outlined"};const Ue=Ae;function ee(e){for(var o=1;o<arguments.length;o++){var l=arguments[o]!=null?Object(arguments[o]):{},c=Object.keys(l);typeof Object.getOwnPropertySymbols=="function"&&(c=c.concat(Object.getOwnPropertySymbols(l).filter(function(i){return Object.getOwnPropertyDescriptor(l,i).enumerable}))),c.forEach(function(i){ze(e,i,l[i])})}return e}function ze(e,o,l){return o in e?Object.defineProperty(e,o,{value:l,enumerable:!0,configurable:!0,writable:!0}):e[o]=l,e}var J=function(o,l){var c=ee({},o,l.attrs);return s(ne,ee({},c,{icon:Ue}),null)};J.displayName="MinusOutlined";J.inheritAttrs=!1;const Ee=J;var Fe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M893.3 293.3L730.7 130.7c-7.5-7.5-16.7-13-26.7-16V112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V338.5c0-17-6.7-33.2-18.7-45.2zM384 184h256v104H384V184zm456 656H184V184h136v136c0 17.7 14.3 32 32 32h320c17.7 0 32-14.3 32-32V205.8l136 136V840zM512 442c-79.5 0-144 64.5-144 144s64.5 144 144 144 144-64.5 144-144-64.5-144-144-144zm0 224c-44.2 0-80-35.8-80-80s35.8-80 80-80 80 35.8 80 80-35.8 80-80 80z"}}]},name:"save",theme:"outlined"};const Be=Fe;function te(e){for(var o=1;o<arguments.length;o++){var l=arguments[o]!=null?Object(arguments[o]):{},c=Object.keys(l);typeof Object.getOwnPropertySymbols=="function"&&(c=c.concat(Object.getOwnPropertySymbols(l).filter(function(i){return Object.getOwnPropertyDescriptor(l,i).enumerable}))),c.forEach(function(i){Ie(e,i,l[i])})}return e}function Ie(e,o,l){return o in e?Object.defineProperty(e,o,{value:l,enumerable:!0,configurable:!0,writable:!0}):e[o]=l,e}var Q=function(o,l){var c=te({},o,l.attrs);return s(ne,te({},c,{icon:Be}),null)};Q.displayName="SaveOutlined";Q.inheritAttrs=!1;const De=Q,H=e=>A.get(`/prompt?id=${e}`),Ne=e=>A.get(`/prompt/${e}`),Re=e=>A.post("/prompt",e),ae=e=>A.put(`/prompt/${e.id}`,e),Ge=e=>A.delete(`/prompt/${e}`),He=oe({name:"UpdatePrompt"}),Te=Object.assign(He,{props:{visible:Boolean,formState:Object},emits:["update:visible","submit"],setup(e,{emit:o}){const l=e,c={span:4},i={span:14},S=le({name:[{required:!0,message:"请输入名称"}],model:[{required:!0,message:"请选择模型"}]}),u=[{label:"gpt-3.5-turbo",value:"gpt-3.5-turbo"},{label:"gpt-4",value:"gpt-4"}],{resetFields:$,validate:O,validateInfos:f}=he.useForm(l.formState,S),j=()=>{o("update:visible",!1)},v=()=>{O().then(()=>{o("submit",Oe(l.formState))})};return(U,y)=>{const z=d("a-input"),k=d("a-form-item"),M=d("a-select-option"),B=d("a-select"),I=d("a-form"),E=d("a-modal");return g(),T(E,{title:e.formState.id?"编辑":"新增",visible:e.visible,onCancel:j,onOk:v},{default:p(()=>[s(I,{"label-col":c,"wrapper-col":i},{default:p(()=>[s(k,X({label:"名称"},x(f).name),{default:p(()=>[s(z,{value:e.formState.name,"onUpdate:value":y[0]||(y[0]=h=>e.formState.name=h)},null,8,["value"])]),_:1},16),s(k,X({label:"模型"},x(f).model),{default:p(()=>[s(B,{value:e.formState.model,"onUpdate:value":y[1]||(y[1]=h=>e.formState.model=h)},{default:p(()=>[(g(),w(K,null,q(u,h=>s(M,{key:h.value,value:h.value},{default:p(()=>[C(P(h.label),1)]),_:2},1032,["value"])),64))]),_:1},8,["value"])]),_:1},16)]),_:1})]),_:1},8,["title","visible"])}}});const qe={class:"flex p-3 bg-white"},Ke={class:"w-[450px]"},Je={key:0},Qe={class:"text-rose-500"},We={key:1},Xe={class:"flex-1"},Ye={class:"mb-5"},Ze={key:0},et={class:"whitespace-pre-wrap rounded-lg border border-gray-300 p-3 ml-5"},tt=oe({name:"Group"}),at=Object.assign(tt,{setup(e){const o=we();let l;const c=b([]),i=b([]),S=b(null),u=b({}),$=b([]),O=b(!1),f=le({}),j=b(!1),v=b(""),U=b([]),y=b(!0);let z=[];const k=Ce(()=>u.value.fragments?u.value.fragments.filter(a=>a.selected).map(a=>a.content).join(`
`):""),M=(a,t)=>{let r;for(let _=0;_<t.length;_++){const m=t[_];m.children&&(m.children.some(N=>N.id===a)?r=m.id:M(a,m.children)&&(r=M(a,m.children)))}return r};Pe(v,a=>{const t=z.map(r=>r.name.toLocaleLowerCase().indexOf(a.toLocaleLowerCase())>-1?M(r.id,c.value):null).filter((r,_,m)=>r&&m.indexOf(r)===_);U.value=t,v.value=a,y.value=!0});const B=a=>{U.value=a,y.value=!1},I=a=>{u.value.fragments[a].selected=!u.value.fragments[a].selected},E=a=>{a===void 0?u.value.fragments.push({content:"",selected:!1}):u.value.fragments.splice(a+1,0,{content:"",selected:!1})},h=a=>{u.value.fragments.splice(a,1)},W=a=>{Ne(a).then(t=>{u.value=t.data})},se=()=>{Z.confirm({title:"提示",content:"确定保存吗？",onOk(){u.value.fragments.forEach((a,t)=>{a.orderIndex=t}),ae(u.value).then(()=>{V.success("保存成功")})}})},re=a=>{const{id:t,name:r,model:_}=a;t?ae({id:t,name:r,model:_,fragments:u.value.fragments}).then(()=>{V.success("更新成功"),O.value=!1,H(l).then(m=>{i.value=m.data})}):Re({name:r,model:_,groupId:l}).then(()=>{V.success("创建成功"),O.value=!1,H(l).then(m=>{i.value=m.data})})},ue=()=>{f.id=null,f.name="",f.model="gpt-3.5-turbo",O.value=!0},ce=()=>{const{id:a,name:t,model:r}=u.value;f.id=a,f.name=t,f.model=r,O.value=!0},D=a=>{l=a[0],H(l).then(t=>{const r=t.data;r.length?(S.value=r[0].id,W(r[0].id)):(S.value=null,u.value={}),i.value=r})},ie=()=>{Z.confirm({title:"提示",content:`确定删除${u.value.name}吗？`,onOk(){Ge(u.value.id).then(()=>{V.success("删除成功"),D([l])})}})},de=()=>{ge().then(a=>{z=a.data;const t=xe(a.data);c.value=t,t.length>0&&($.value=[t[0].id],D($.value))})},pe=()=>{j.value=!0},me=()=>{window.localStorage.setItem("prompt",k.value),o.push("/chat")},ve=()=>{navigator.clipboard&&navigator.clipboard.writeText(k.value).then(()=>{V.success("复制成功")})};return Se(()=>{de()}),(a,t)=>{const r=d("a-input"),_=d("a-tree"),m=d("a-select-option"),N=d("a-select"),fe=d("a-textarea"),R=d("a-button"),_e=d("a-modal"),be=d("page-container");return g(),T(be,null,{default:p(()=>[L("div",qe,[L("div",Ke,[s(r,{value:v.value,"onUpdate:value":t[0]||(t[0]=n=>v.value=n),class:"mb-4 w-[300px]",placeholder:"Search"},null,8,["value"]),s(_,{selectedKeys:$.value,"onUpdate:selectedKeys":t[1]||(t[1]=n=>$.value=n),"expanded-keys":U.value,"tree-data":c.value,"auto-expand-parent":y.value,"field-names":{children:"children",title:"name",key:"id"},onSelect:D,onExpand:B},{title:p(({name:n})=>[n.toLocaleLowerCase().indexOf(v.value.toLocaleLowerCase())>-1?(g(),w("span",Je,[C(P(n.substr(0,n.toLocaleLowerCase().indexOf(v.value.toLocaleLowerCase()))),1),L("span",Qe,P(n.substr(n.toLocaleLowerCase().indexOf(v.value.toLocaleLowerCase()),v.value.length)),1),C(P(n.substr(n.toLocaleLowerCase().indexOf(v.value.toLocaleLowerCase())+v.value.length)),1)])):(g(),w("span",We,P(n),1))]),_:1},8,["selectedKeys","expanded-keys","tree-data","auto-expand-parent"])]),L("div",Xe,[L("div",Ye,[s(N,{value:S.value,"onUpdate:value":t[2]||(t[2]=n=>S.value=n),class:"w-[300px] mr-2",onChange:W},{default:p(()=>[(g(!0),w(K,null,q(i.value,n=>(g(),T(m,{key:n.id,value:n.id},{default:p(()=>[C(P(n.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"]),s(x(Y),{class:"text-base mr-2 text-primary",onClick:ue}),s(x(ke),{class:"text-base mr-2 text-amber-600",onClick:ce}),s(x(De),{class:"text-base mr-2 text-green-500",onClick:se}),s(x(Le),{class:"text-base mr-2 text-rose-500",onClick:ie}),s(x($e),{class:"text-base mr-2 text-yellow-500",onClick:ve})]),u.value.id?(g(),w("div",Ze,[(g(!0),w(K,null,q(u.value.fragments,(n,G)=>(g(),w("div",{key:n.id,class:"flex mb-2 w-full"},[s(x(Me),{class:Ve([{active:n.selected},"prompt-checked text-2xl text-gray-400 mr-2 mt-1 cursor-pointer"]),onClick:F=>I(G)},null,8,["class","onClick"]),s(fe,{value:n.content,"onUpdate:value":F=>n.content=F,"auto-size":{minRows:1,maxRows:10}},null,8,["value","onUpdate:value"]),s(x(Y),{class:"text-xl text-primary mt-2 ml-2 cursor-pointer",onClick:F=>E(G)},null,8,["onClick"]),s(x(Ee),{class:"text-xl text-rose-500 mt-2 ml-2 cursor-pointer",onClick:F=>h(G)},null,8,["onClick"])]))),128)),s(R,{class:"mr-2",type:"primary",onClick:t[3]||(t[3]=n=>E())},{default:p(()=>[C("添加")]),_:1}),s(R,{class:"mr-2",type:"primary",onClick:t[4]||(t[4]=n=>pe())},{default:p(()=>[C("预览")]),_:1}),s(R,{class:"mr-2",type:"primary",onClick:t[5]||(t[5]=n=>me())},{default:p(()=>[C("提交")]),_:1})])):je("",!0)])]),s(Te,{visible:O.value,"onUpdate:visible":t[6]||(t[6]=n=>O.value=n),"form-state":f,onSubmit:re},null,8,["visible","form-state"]),s(_e,{visible:j.value,"onUpdate:visible":t[7]||(t[7]=n=>j.value=n),title:"预览",footer:null,width:800,"body-style":{height:"calc(100vh - 200px)",overflow:"auto"}},{default:p(()=>[L("div",et,P(k.value),1)]),_:1},8,["visible","body-style"])]),_:1})}}}),ot=ye(at,[["__scopeId","data-v-a5acd3bd"]]);export{ot as default};
